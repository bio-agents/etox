{% extends '::frontend.html.twig' %}
{% block title %}Listing Evidences {% endblock %}
{% block article %}
    {% include 'FrontendBundle:Search_document:tags_code.html.twig' %}
    <div id="evidences">
        {% set entityName=entity.getName %}
        <!-- <a href="{{ path('export_abstracts',{'field':field, 'whatToSearch': whatToSearch, 'entityType': entityType, 'entityName': entityName, 'download': true}) }}">(Generate a file with results)</a>  -->
        {% set agenttipCounter=1 %}
        {% set stringStickyAgenttip = "" %}
        {% set foundFor=entityType %}
        {% if foundFor=="CompoundDict" %}
            {% set foundFor="Compound" %}
        {% endif %}
        {% if orderBy is not defined %}
            {% set orderBy = default_orderby %}
        {% endif %}
        {% set entityId = entity.getId %}
        {% if arrayEntity2Document is defined %}
        <h3>Ranked sentences in Documents for {{foundFor}}: <span class="underline">{{ entityBackup }}</span> search</h3>
            <div class="btmspc-dbl">
                <small>
                    <em>
                        Entity mentions are highlighted as follows:
                        <mark class="termSearched">What you searched</mark>, <mark class="compound">Compounds</mark>, <mark class="cytochrome">Cytochromes</mark>, <mark class="marker">Markers</mark>, <mark class="term">Terms</mark>, <mark class="specie">Species</mark>
                        . Curated evidences are indicated by:
                        <a class="curated" href="#"> </a>
                    </em>
                </small>
            </div>
            <div class="results-summary">
                    {% set totalHits = arrayTotalMaxMin[0] %}
                    {% if entityType=="CompoundDict" or entityType=="Marker"%}
                        {% set scoreToShow = "Score" %}
                    {% elseif entityType=="Cytochrome" %}
                        {% set scoreToShow = orderBy | getScoreToShowRelations %}
                    {% endif %}
                    {% set maxScore= arrayTotalMaxMin[1] %}
                    {% set minScore= arrayTotalMaxMin[2] %}
                    {% set order =  orderBy | getOrderToSource %}
                    <table class="summary">
                        <tr>
                            <td><strong>Total number of mentions displayed:</strong> {{ totalHits }}<br/></td>
                            <td><strong>Maximum {{scoreToShow}}:</strong> {{ maxScore |number_format(2) }}</td>
                            <td><strong>Minimum {{scoreToShow}}:</strong> {{ minScore |number_format(2) }}</td>
                            <td><strong>{{scoreToShow}} mean:</strong> {{ meanScore | number_format(2) }}</td>
                            <td><strong>{{scoreToShow}} median:</strong> {{ medianScore | number_format(2) }}</td>
                        </tr>
                        {% if entityType=="CompoundDict" %}
                            <tr>
                                <td colspan="5">
                                    <span data-agenttip="stickyCytoscape">
                                        <a href="{{ path('cytoscape', {'entityType': entityType, 'entityName': entityName}) }}" target="_blank"><strong>View Interaction Network</strong></a>
                                    </span>
                                    {# set agenttip="Click here to get a graph with all the relations of this entity inside Limtox" #}
                                     {% set agenttip =  "<div id='stickyCytoscape' class='atip'>
                                                        Click here to get a graph with all the relations of "~ entityName ~" inside Limtox
                                                    </div>"
                                    %}
                                    {% set stringStickyAgenttip = stringStickyAgenttip ~ agenttip  %}
                                </td>
                            </tr>
                        {% endif %}
                        <tr>
                            <td colspan="5">
                                <a href="{{ path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby', {'field': field, 'whatToSearch': whatToSearch, 'source': source, 'entityType': entityType, 'entityName': entityBackup, 'orderBy': orderBy})}}?download=csv" class="start-preload"><strong>Download results</strong></a>
                                {# Uncomment this to enable multiple download formats. Just add new block for new formats
                                <span data-agenttip="stickyDownload">
                                    <a href="#"><strong>Download results</strong></a>
                                </span>

                                    {%
                                    set agenttip =  "
                                        <div id='stickyDownload' class='atip'>
                                            <ul class='download-list'>
                                                <li><a  href="~path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby', {'field': field, 'whatToSearch': whatToSearch, 'source': source, 'entityType': entityType, 'entityName': entityBackup, 'orderBy': orderBy}) ~'?download=csv'~">
                                                        <img src="~ asset('images/icons/csv.png')~" border='0' />
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>"
                                    %}
                                    {% set stringStickyAgenttip = stringStickyAgenttip ~ agenttip  %}
                                #}
                            </td>
                        </tr>
                        {% if (entityType=="CompoundDict" and whatToSearch=="name") or (entityType=="CompoundDict" and whatToSearch=="id") or (entityType=="Cytochrome" and whatToSearch=="name") or (entityType=="Marker" and whatToSearch=="name") %}
                            <tr>
                                <td colspan="5">
                                    {% if entityType=="CompoundDict" %}
                                        {% set typeOfEntity = "Compound" %}
                                    {% else %}
                                        {% set typeOfEntity = entityType %}
                                    {% endif %}

                                    <a href="#" class="toggleSummaryInfo"><strong>See {{typeOfEntity}} info: {{ entityBackup }}</strong></a>
                                    {% if entityType=="CompoundDict" %}
                                        {% set structure = entity.getStructure %}
                                        {% if structure is not null %}
                                            (<a href="{{ path('download_sdf', {'filename': structure.pathtosdf}) }}">Download mol file</a>)
                                        {% endif %}
                                    {% endif %}
                                    <div id="mouseoverSummary">
                                        <table>
                                            <tr>
                                                <td colspan="5">
                                                        {{ mouseoverSummary | raw }}
                                                </td>
                                            </tr>
                                            {% if entityType=="CompoundDict" and whatToSearch=="name" %}
                                            <tr>
                                                <td>
                                                    <strong>Alliases</strong>
                                                </td>
                                                <td colspan="4">
                                                    {{ allias | replace({("|"): ", "}) }}
                                                </td>
                                            </tr>
                                            {% endif %}
                                            {% if entityType=="CompoundDict" %}
                                                {% set existImage = entity.getImage %}
                                                {% if existImage is not null %}
                                                    {% set idImage = entity.getImage.getCompound%}
                                                    <tr>
                                                    <td colspan="5">
                                                            {% set imageCompound = "images/imagesCompound/"~idImage~".png" %}
                                                            <img src="{{ asset(imageCompound) }}" border="0" />
                                                    </td>
                                                </tr>
                                                {% endif %}
                                                <tr>
                                                    <td>
                                                        <input id="tanimoto-compound-1" autocomplete="off" role="textbox" aria-autocomplete="list" aria-haspopup="true" placeholder="Compound 1" onclick="this.value=''" class="tanimoto" id="compoundName2" name="compoundName2" value="{{ entityBackup }}">
                                                    </td>
                                                    <td>
                                                        <input id="tanimoto-compound-2" autocomplete="off" role="textbox" aria-autocomplete="list" aria-haspopup="true" placeholder="Compound 2" onclick="this.value=''" class="tanimoto" id="compoundName2" name="compoundName2">
                                                        <a href="#" onclick="calculateTanimoto('/calculate_tanimoto/')" id="calculate-tanimoto" class="tanimoto">Calculate Tanimoto Coef.</a>
                                                    </td>
                                                    <td>
                                                        <div id="tanimoto-result"></div>
                                                    </td>
                                                    <td>
                                                    </td>
                                                    <td>
                                                    </td>
                                                </tr>
                                                	{% if arrayTanimotos | length > 0 %}
                                                <tr>
                                                	<td colspan="2">
                                                		<strong>List of compounds with a Tanimoto coeff. > 0.5:</strong>
                                                		<ul class='tanimotolist'>
                                                		{%for tanimotoValue in arrayTanimotos%}
                                                			{% set compound1 = tanimotoValue.getCompound2.getName %}
                                                			{% set compound2 = tanimotoValue.getCompound1.getName %}
                                                			{% if entityBackup==compound1 %}
                                                				{% set compound1=compound2 %}
                                                			{% endif %}
                                                			<li class='tanimotolist'><strong>{{ compound1 }} </strong>: {{tanimotoValue.tanimoto}}</li>
                                                		{% endfor %}
                                                		</ul>
													</td>
                                                </tr>
                                                	{% endif %}
                                            {% endif %}
                                        </table>
                                    </div>
                                </td>
                            </tr>
                        {% endif %}
                    </table>
                </div>
            <div class="clear-both"></div>
            <div id="documentsResults">
                <a name="documents"></a>
                {% if entityType in ["Cytochrome", "Marker"] %}
                {% else %}
                    {% if arrayEntity2Abstract is defined %}
                        <div class="jumpToDocuments">
                            <a href="#" id="jumpToAbstracts">(View abstracts)</a>
                        </div>
                    {% endif %}
                {% endif %}

                <small>
                    <em>
                        <span class="left">Color key for scores:&nbsp;&nbsp; </span>{% include 'FrontendBundle:Search_document:score_color_coding.html.twig' %}
                    </em>
                </small>

                <table id="tableResults" class="tablesorter">
                    <thead>
                        <th><span data-agenttip class="has-tip" title="{{ mouseover_source}}">Source</span></th>
                        <th>
                            <a href="{{ path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby',{'field':field, 'whatToSearch': whatToSearch, 'entityType': entityType, 'source': source, 'entityName': entityBackup, 'orderBy': 'score'}) }}" {% if orderBy == "score"%} class="active"{% endif %}
                            ><span data-agenttip class="has-tip" title="{{ mouseover_svm}}">SVM</span>
                            </a>
                        </th>
                        <th>
                            <a href="{{ path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby',{'field':field, 'whatToSearch': whatToSearch, 'entityType': entityType, 'source': source, 'entityName': entityBackup, 'orderBy': 'svmConfidence'}) }}"  {% if orderBy == "svmConfidence"%} class="active"{% endif %}
                            ><span data-agenttip class="has-tip" title="{{ mouseover_conf}}">Conf.</span></a>
                        </th>
                        <th>
                            <a href="{{ path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby',{'field':field, 'whatToSearch': whatToSearch, 'entityType': entityType, 'source': source, 'entityName': entityBackup, 'orderBy': 'pattern'}) }}" {% if orderBy == "pattern"%} class="active"{% endif %}
                            ><span data-agenttip class="has-tip" title="{{ mouseover_pattern}}">Pattern</span>
                            </a>
                        </th>
                        <th>
                            <a href="{{ path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby',{'field':field, 'whatToSearch': whatToSearch, 'entityType': entityType, 'source': source, 'entityName': entityBackup, 'orderBy': 'term'}) }}"  {% if orderBy == "term"%} class="active"{% endif %}
                            ><span data-agenttip class="has-tip" title="{{ mouseover_term}}">Term</span></a>
                        </th>
                        <th>
                            <a href="{{ path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby',{'field':field, 'whatToSearch': whatToSearch, 'entityType': entityType, 'source': source, 'entityName': entityBackup, 'orderBy': 'rule'}) }}"  {% if orderBy == "rule"%} class="active"{% endif %}
                            ><span data-agenttip class="has-tip" title="{{ mouseover_rule}}">Rule</span></a>
                        </th>
                        <th>Sentence</th>
                        <th>
                            <a href="{{ path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby',{'field':field, 'whatToSearch': whatToSearch, 'entityType': entityType, 'source': source, 'entityName': entityName, 'orderBy': 'curation'}) }}" {% if orderBy == "curation"%} class="active"{% endif %}
                            ><span data-agenttip class="has-tip" title="{{ mouseover_relation_curation}}">Curation
                            </a>
                        </th>
                    </thead>
                    <tbody>
                        {% set contador = 1 %}
                        {% for entity2Document in arrayEntity2Document %}
                            <tr class="document {{ cycle(['odd', 'even'], contador) }}">
                                {% set contador = contador + 1 %}
                                {% set kind = entity2Document.document.getKind %}
                                {% set score = entity2Document.document.getHepval %}
                                {% set score = score|number_format(2) %}
                                {% set score = score|colorCodingScore %}
                                {% set patternCount = entity2Document.document.getPatternCount %}
                                {% set patternCount = patternCount|colorCodingScore %}
                                {% set ruleScore = entity2Document.document.getRuleScore %}
                                {% set ruleScore = ruleScore|number_format(2) %}
                                {% set ruleScore = ruleScore|colorCodingScore %}
                                {% set termScore = entity2Document.document.getHepTermVarScore %}
                                {% set termScore = termScore|colorCodingScore %}
                                {% set svmConfidence = entity2Document.document.getSvmConfidence %}
                                {% set svmConfidence = svmConfidence|number_format(3) %}
                                {% set svmConfidence = svmConfidence|colorCodingScore %}

                                <td>
                                {% if kind == "pubmed" %}
                                    {% set pmid=entity2Document.document.getUid %}
                                    {% set link="http://www.ncbi.nlm.nih.gov/pubmed/" ~ pmid %}
                                    {% set imageRoute = 'images/pubmed.png' %}
                                    {% set sid=entity2Document.document.getSentenceId %}
                                    <span data-agenttip='sticky{{ agenttipCounter }}'>
                                            <a href="{{ link }}" target="_blank"><img src="{{ asset(imageRoute) }}" class="outlinkLogo"/></a>
                                        </span>
                                    {% set agenttip =  "<div id='sticky"~agenttipCounter~"' class='atip' >Pubmed link: <a href='"~link ~"'>"~link~"</a><br>Pubmed Id: "~ pmid ~"<br/>Sentence Id: "~ sid ~"<br/></div>" %}
                                    {% set agenttipCounter = agenttipCounter + 1 %}
                                    {% set stringStickyAgenttip = stringStickyAgenttip ~ agenttip  %}

                                {% elseif kind == "fulltext" %}
                                    {% set pmid=entity2Document.document.getUid %}
                                    {% set arrayPmid = pmid|split('_') %}
                                    {% set pmidCut = arrayPmid[1] %}
                                    {% set link="http://www.ncbi.nlm.nih.gov/pubmed/" ~ pmidCut %}
                                    {% set imageRoute = 'images/fulltext.png' %}
                                    {% set sid=entity2Document.document.getSentenceId %}
                                        <span data-agenttip='sticky{{ agenttipCounter }}'>
                                            <a href="{{ link }}" target="_blank"><img src="{{ asset(imageRoute) }}" class="outlinkLogo"/></a>
                                        </span>
                                    {% set agenttip =  "<div id='sticky"~agenttipCounter~"' class='atip' >Pubmed link: <a href='"~link ~"'>"~link~"</a><br>Pubmed Id: "~ pmidCut ~"<br/>Sentence Id: "~ sid ~"</div>" %}
                                    {% set agenttipCounter = agenttipCounter + 1 %}
                                    {% set stringStickyAgenttip = stringStickyAgenttip ~ agenttip  %}
                                {% elseif kind == "nda" %}
                                    {% set link="http://www.accessdata.fda.gov/scripts/cder/drugsatfda/index.cfm" %}
                                    {% set imageRoute = 'images/nda.png' %}
                                    {% set sid=entity2Document.document.getSentenceId %}
                                    <span data-agenttip='sticky{{ agenttipCounter }}'>
                                            <a href="{{ link }}" target="_blank"><img src="{{ asset(imageRoute) }}" class="outlinkLogo"/ alt="FDA New Drug Approvals (NDAs)" title="FDA New Drug Approvals (NDAs)"></a>
                                        </span>
                                    {% set agenttip =  "<div id='sticky"~agenttipCounter~"' class='atip' >Sentence Id: "~ sid ~"</div>" %}
                                    {% set agenttipCounter = agenttipCounter + 1 %}
                                    {% set stringStickyAgenttip = stringStickyAgenttip ~ agenttip  %}

                                {% elseif kind == "epar" %}
                                    {% set link="http://www.ema.europa.eu/ema/index.jsp?curl=pages/medicines/landing/epar_search.jsp" %}
                                    {% set imageRoute = 'images/epar.png' %}
                                    {% set sid=entity2Document.document.getSentenceId %}
                                    <span data-agenttip='sticky{{ agenttipCounter }}'>
                                        <a href="{{ link }}" target="_blank"><img src="{{ asset(imageRoute) }}" class="outlinkLogo"/ alt="European Public Assessment Reports (EPARs)" title="European Public Assessment Reports (EPARs)"></a>
                                    </span>
                                    {% set agenttip =  "<div id='sticky"~agenttipCounter~"' class='atip' >Sentence Id: "~ sid ~"</div>" %}
                                    {% set agenttipCounter = agenttipCounter + 1 %}
                                    {% set stringStickyAgenttip = stringStickyAgenttip ~ agenttip  %}

                                {% endif %}
                                </td>
                                <td class="center">
                                    {{ score |raw }}
                                </td>
                                <td class="center">
                                    {{ svmConfidence |raw }}
                                </td>
                                <td class="center">
                                    {{ patternCount | raw }}
                                </td>
                                <td class="center">
                                    {{ termScore |raw }}
                                </td>
                                <td class="center">
                                    {{ ruleScore |raw }}
                                </td>
                                {% set text=entity2Document.document.getText %}
                                {% set arrayText= text | highlightEntitiesDocuments (entity2Document.document,entityBackup,field,whatToSearch, source, entityType, agenttipCounter) %}
                                {% set text = arrayText[0] | raw %}
                                {% set stringStickyAgenttip = stringStickyAgenttip ~ arrayText[1] %}
                                {% set agenttipCounter = arrayText[2] %}
                                <td>
                                    {% if kind in ['fulltext','epar','nda'] %}
                                        "{{ text | raw }}"
                                    {% else %}
                                        {{ text | raw }}
                                    {% endif %}

                                </td>
                                <td class="center">
                                    {# entity2Document |ld #}
                                    {% set curation=entity2Document.getCuration %}
                                    {% if curation is empty %}
                                        {% set curation="None" %}
                                    {% endif %}
                                    {% set curationHtml= curation | setCurationHtml(entity2Document.getId(), entityType, "document") %}
                                    <div id="free-curation-{{ entity2Document.getId }}">
                                        {# entity2Document.getId #}
                                        <small>
                                            {{ curationHtml | raw }}<br/>{{ curation }}
                                        </small>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <!-- here pagination block for Documents -->
               <div class="pagination">
                    {{ simple_paginator_render(
                        'search_interface_search_field_whatToSearch_entityType_source_entity_orderby', 'documents',
                            {
                                'routeParams' : {'field' : field, 'whatToSearch' : whatToSearch, 'entityType' : entityType, 'source' : source, 'entityName' : entityBackup, 'orderBy' : orderBy},
                                'container_class' : 'pagination'
                            }
                        )
                    }}
                </div>
            </div>
        {% endif %}
        {% if arrayEntity2Abstract is defined %}
            <h3>Ranked Abstracts for {{foundFor}}: <span class="underline">{{ entityBackup }}</span> search</h3>
                <div data-alert class="alert-box info radius">
                  Entity mentions <strong>ARE NOT highlighted</strong> when searching <strong>inside Abstracts</strong>
                  <a href="#" class="close">&times;</a>
                </div>

            <div class="results-summary">
                    {% set totalHits = arrayTotalMaxMin[0] %}
                    {% set scoreToShow = orderBy | getScoreToShow %}
                    {% set maxScore= arrayTotalMaxMin[1] %}
                    {% set minScore= arrayTotalMaxMin[2] %}
                    {% set order =  orderBy | getOrderToSource %}
                    <table>
                        <tr>
                            <td><strong>Total number of mentions displayed:</strong> {{ totalHits }}</td>
                            <td><strong>Maximum {{scoreToShow}}:</strong> {{ maxScore |number_format(2) }}</td>
                            <td><strong>Minimum {{scoreToShow}}:</strong> {{ minScore |number_format(2) }}</td>
                            <td><strong>{{scoreToShow}} mean:</strong> {{ meanScore | number_format(2) }}</td>
                            <td><strong>{{scoreToShow}} median:</strong> {{ medianScore | number_format(2) }}</td>
                        </tr>
                        <tr>
                            <td colspan="5">
                                <a href="{{ path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby', {'field': field, 'whatToSearch': whatToSearch, 'source': source, 'entityType': entityType, 'entityName': entityBackup, 'orderBy': orderBy})}}?download=csv" class="start-preload"><strong>Download results</strong></a>
                                {# Uncomment this to enable multiple download formats. Just add new block for new formats
                                    <span data-agenttip="stickyDownload">
                                        <a href="#"><strong>Download results</strong></a>
                                    </span>
                                    {%
                                    set agenttip =  "
                                        <div id='stickyDownload' class='atip'>
                                            <ul class='download-list'>
                                                <li><a  href="~path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby', {'field': field, 'whatToSearch': whatToSearch, 'source': source, 'entityType': entityType, 'entityName': entityName, 'orderBy': orderBy}) ~'?download=csv'~">
                                                        <img src="~ asset('images/icons/csv.png')~" border='0' />
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>"
                                    %}
                                    {% set stringStickyAgenttip = stringStickyAgenttip ~ agenttip  %}
                                #}
                            </td>
                        </tr>
                    </table>
                </div>
            <div class="clear-both"></div>
            <small>
                    <em>
                    <span class="left">Color key for scores:&nbsp;&nbsp; </span>{% include 'FrontendBundle:Search_document:score_color_coding.html.twig' %}
                    </em>
                </small>
            <div id="abstractsResults">
                <a name="abstracts"></a>
                {% if arrayEntity2Document is defined %}
                    <div class="jumpToDocuments">
                        <a href="#documents" id="jumpToDocuments">(View sentences)</a>
                    </div>
                {% endif %}
                <table id="tableResults" class="tablesorter">
                    <thead>
                        <th><span data-agenttip class="has-tip" title="{{ mouseover_source}}">Source</span></th>
                        <th>
                            <a href="{{ path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby',{'field':field, 'whatToSearch': whatToSearch, 'entityType': entityType, 'source': source, 'entityName': entityBackup, 'orderBy': 'score'}) }}" {% if orderBy == "score"%} class="active"{% endif %}
                            ><span data-agenttip class="has-tip" title="{{ mouseover_svm}}">SVM</span>
                            </a>
                        </th>
                        <th>
                            <a href="{{ path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby',{'field':field, 'whatToSearch': whatToSearch, 'entityType': entityType, 'source': source, 'entityName': entityBackup, 'orderBy': 'svmConfidence'}) }}"  {% if orderBy == "svmConfidence"%} class="active"{% endif %}
                            ><span data-agenttip class="has-tip" title="{{ mouseover_conf}}">Conf.</span></a>
                        </th>
                        <th>
                            <a href="{{ path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby',{'field':field, 'whatToSearch': whatToSearch, 'entityType': entityType, 'source': source, 'entityName': entityBackup, 'orderBy': 'pattern'}) }}" {% if orderBy == "pattern"%} class="active"{% endif %}
                            ><span data-agenttip class="has-tip" title="{{ mouseover_pattern}}">Pattern</span>
                            </a>
                        </th>
                        <th>
                            <a href="{{ path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby',{'field':field, 'whatToSearch': whatToSearch, 'entityType': entityType, 'source': source, 'entityName': entityBackup, 'orderBy': 'term'}) }}"  {% if orderBy == "term"%} class="active"{% endif %}
                            ><span data-agenttip class="has-tip" title="{{ mouseover_term}}">Term</span></a>
                        </th>
                        <th>
                            <a href="{{ path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby',{'field':field, 'whatToSearch': whatToSearch, 'entityType': entityType, 'source': source, 'entityName': entityBackup, 'orderBy': 'rule'}) }}"  {% if orderBy == "rule"%} class="active"{% endif %}
                            ><span data-agenttip class="has-tip" title="{{ mouseover_rule}}">Rule</span></a>
                        </th>
                        <th>
                            <a href="{{ path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby',{'field':field, 'whatToSearch': whatToSearch, 'entityType': entityType, 'source': source, 'entityName': entityBackup, 'orderBy': 'toxicology'}) }}"  {% if orderBy == "toxicology"%} class="active"{% endif %}
                            ><span data-agenttip class="has-tip" title="{{ mouseover_toxicology}}">Toxicology</span></a>
                        </th>
                        <th>
                            <a href="{{ path('search_interface_search_field_whatToSearch_entityType_source_entity_orderby',{'field':field, 'whatToSearch': whatToSearch, 'entityType': entityType, 'source': source, 'entityName': entityBackup, 'orderBy': 'biomarker'}) }}"  {% if orderBy == "biomarker"%} class="active"{% endif %}
                            ><span data-agenttip class="has-tip" title="{{ mouseover_biomarker}}">Biomarker</span></a>
                        </th>
                        <th>Sentence</th>
                        <th><span data-agenttip class="has-tip" title="{{ mouseover_curation}}">Curation</span></th>
                    </thead>
                    <tbody>
                        {% set contador = 1 %}
                        {% for entity2Abstract in arrayEntity2Abstract %}
                            <tr class="document {{ cycle(['odd', 'even'], contador) }}">
                                {% set contador = contador + 1 %}
                                {% set pmid=entity2Abstract.abstracts.getPmid %}
                                {% set link="http://www.ncbi.nlm.nih.gov/pubmed/" ~ pmid %}
                                {% set imageRoute = 'images/pubmed.png' %}
                                {% set agenttip =  "<div id='sticky"~agenttipCounter~"' class='atip' >Pubmed link: <a href='"~link ~"'>"~link~"</a><br>Pubmed Id: "~ pmid ~"</div>" %}

                                {% set stringStickyAgenttip = stringStickyAgenttip ~ agenttip  %}
                                {% set score = entity2Abstract.abstracts.getHepval %}
                                {% set score = score|number_format(2) %}
                                {% set score = score|colorCodingScore %}
                                {% set patternCount = entity2Abstract.abstracts.getPatternCount %}
                                {% set patternCount = patternCount|colorCodingScore %}
                                {% set ruleScore = entity2Abstract.abstracts.getRuleScore %}
                                {# set ruleScore = ruleScore|number_format(2) #}
                                {% set ruleScore = ruleScore|colorCodingScore %}
                                {% set termScore = entity2Abstract.abstracts.getHepTermVarScore %}
                                {% set termScore = termScore|colorCodingScore %}
                                {% set svmConfidence = entity2Abstract.abstracts.getSvmConfidence %}
                                {% set svmConfidence = svmConfidence|number_format(3) %}
                                {% set svmConfidence = svmConfidence|colorCodingScore %}
                                {% set toxicology = entity2Abstract.abstracts.getToxicology %}
                                {% set toxicology = toxicology|number_format(3) %}
                                {% set toxicology = toxicology|colorCodingScore %}
                                {% set biomarker = entity2Abstract.abstracts.getBiomarker %}
                                {% set biomarker = biomarker|number_format(3) %}
                                {% set biomarker = biomarker|colorCodingScore %}
                                <td>
                                    <span data-agenttip='sticky{{ agenttipCounter }}'>
                                        <a href="{{ link }}" target="_blank"><img src="{{ asset(imageRoute) }}" class="outlinkLogo"/></a>
                                    </span>
                                </td>
                                {% set agenttipCounter = agenttipCounter + 1 %}
                                <td class="center">
                                    {{ score |raw }}
                                </td>
                                <td class="center">
                                    {{ svmConfidence |raw }}
                                </td>
                                <td class="center">
                                    {{ patternCount | raw }}
                                </td>
                                <td class="center">
                                    {{ termScore |raw }}
                                </td>
                                <td class="center">
                                    {{ ruleScore |raw }}
                                </td>

                                <td class="center">
                                    {{ toxicology |raw }}
                                </td>
                                <td class="center">
                                    {{ biomarker |raw }}
                                </td>
                                 {% set text = entity2Abstract.abstracts.getText %}
                                 {% set arrayText= text | highlightEntitiesAbstracts (entity2Abstract.abstracts,entityBackup,field,whatToSearch, source, entityType, agenttipCounter) %}
                                {% set text = arrayText[0] | raw %}
                                {% set stringStickyAgenttip = stringStickyAgenttip ~ arrayText[1] %}
                                {% set agenttipCounter = arrayText[2] %}
                                <td>
                                    {{ text| raw }}
                                </td>
                                <td class="center">
                                    {% set curation=entity2Abstract.getCuration %}
                                    {% if curation is empty %}
                                        {% set curation=0 %}
                                    {% endif %}
                                    {% set curationHtml= curation | setCurationHtml(entity2Abstract.getId(), entityType, "abstract") %}
                                    <div id="free-curation-{{ entity2Abstract.getId }}">
                                        <small>
                                            {{ curationHtml | raw }}<br/>{{ curation }}
                                        </small>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>

                </table>
                <!-- here pagination block for Abstracts -->

               <div class="pagination">
                    {{ simple_paginator_render(
                        'search_interface_search_field_whatToSearch_entityType_source_entity_orderby', 'abstracts',
                            {
                                'routeParams' : {'field' : field, 'whatToSearch' : whatToSearch, 'entityType' : entityType, 'source' : source, 'entityName' : entityBackup, 'orderBy' : orderBy },
                                'container_class' : 'pagination'
                            }
                        )
                    }}
                </div>
            </div>
        {% endif %}
        {# Here we rebuild the stringStickyAgenttip inside its container divs #}
        <div id="mystickyagenttip" class="stickyagenttip">
            <div style="padding:5px">
                {{ stringStickyAgenttip | raw }}
            </div>
            <div class="stickystatus"></div>
        </div>
        {% include 'FrontendBundle:Search_document:scripts_code.html.twig' %}
{% endblock %}